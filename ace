#!/usr/bin/env php
<?php

require 'vendor/autoload.php';

$start_time = microtime(true);

$config = Symfony\Component\Yaml\Yaml::parse(file_get_contents('config.yml'));

if (null === $config) {
    exit('Config file does not exists');
}

foreach($config['ace']['command-chunks'] as $commandChunk) {
    $loop = React\EventLoop\Factory::create();

    foreach($commandChunk as $command) {
        $process = new React\ChildProcess\Process($command);
        $process->start($loop);

        $process->on('exit', function() use($command) {
            echo $command . ' finished!' . PHP_EOL;
        });
    }

    $loop->run();
}

$end_time = microtime(true);

echo 'Time spent: ' . round($end_time - $start_time, 2) . ' seconds' . PHP_EOL;
